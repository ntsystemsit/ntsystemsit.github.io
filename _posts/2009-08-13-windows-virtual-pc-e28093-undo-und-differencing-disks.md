---
layout: post
title: "Windows Virtual PC – UnDo und Differencing Disks"
date: 2009-08-13 17:43:33 +0200
comments: true
published: true
excerpt_separator: <!-- more -->
categories: Archive
tags: ["Client"]
redirect_from: ["/post/Windows-Virtual-PC-e28093-UnDo-und-Differencing-Disks", "/post/windows-virtual-pc-e28093-undo-und-differencing-disks"]
author: thomas torggler
---
<!-- more -->
{% include imported_disclaimer.html %}
<p>In meinem <a href="/post/Windows-Virtual-PC.aspx" target="_blank">letzen Beitrag</a> über den Windows Virtual PC habe ich die Undo und differenzierenden Festplatten erwähnt, hier die versprochenen Details.</p>  <p><strong>UnDo Disks – Snapshots für Virtual PC!?</strong></p>  <p>Bei den UnDo Disks handelt es sich um ein Feature das ich in bisherigen Virtual PC Versionen immer vermisste: Man kann den Status einer VM vor einer Änderung sichern und kann auf den Punkt der Sicherung zurückspringen wenn die Änderung nicht so funktioniert wie man sich das vorgestellt hat.</p>  <p>UnDo Disks werden in den Einstellungen der VM aktiviert. Die Virtuelle Maschine muss ausgeschaltet (heruntergefahren) sein damit die Option zur Verfügung steht.</p>  <p><a href="/assets/image_39.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/image_thumb_39.png" width="244" height="165" /></a> </p>  <p>Beim nächsten Start der VM wird eine .vud Datei erstellt, in dieser werden (wie bei einem Snapshot in der Enterprise Umgebung) ab jetzt&#160; alle Änderungen gespeichert. Die VHD bleibt unverändert.</p>  <p><a href="/assets/image_40.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/image_thumb_40.png" width="244" height="71" /></a> </p>  <p>In der Zwischenzeit habe ich um eine Änderung zu simulieren einfach mal ein Programm installiert. Man sieht auch gleich dass die .vud Datei größer wird.</p>  <p><a href="/assets/image_41.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/image_thumb_41.png" width="244" height="78" /></a> </p>  <p>Um die Änderungen in die VHD zu übernehmen bzw. diese zu verwerfen muss man die VM wieder schließen (herunterfahren/Ruhezustand) und in den Einstellungen den entsprechenden Punkt auswählen. Ich habe mich entschieden die Änderungen zu verwerfen also wird meine .vud Datei gelöscht. Nach dieser Aktion wird wieder von der VHD gestartet und alles ist so wie es vorher war.</p>  <p><a href="/assets/image_42.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/image_thumb_42.png" width="244" height="165" /></a>     <br />Wenn man Änderungen übernimmt werden diese in die VHD geschrieben.</p>  <p>Lässt man die Undo Disk aktiv und startet die Virtuelle Maschine wieder, wird erneut eine .vud Datei erstellt in der alle Änderungen bis zum Übernehmen oder Verwerfen separat gespeichert werden. Um die Undo Disk zu deaktivieren muss die virtuelle Maschine heruntergefahren werden, im Ruhezustand geht das nicht.</p>  <p>Insgesamt also ein super Feature, spart einem sicher ‘ne Menge Arbeit.</p>  <p><strong>Differencing Disks</strong></p>  <p>Im zweiten Beispiel installiere ich mehrere neue VMs in differenzierenden Disks auf Basis einer bereits bestehenden Maschine.</p>  <p><strong>Wichtig:</strong> Differenzierende Virtuelle Maschinen basieren auf einer bereits installierten VM, wenn ich also für eine Testumgebung mehrere VMs brauche kann ich eine bestehende beliebig oft duplizieren und so Zeit sparen. Ich habe die Quell-VM mit <strong><a href="http://support.microsoft.com/kb/302577" target="_blank">sysprep</a></strong> vorbereitet um Probleme mit gleichen SID und Computernamen zu verhindern. Wichtig ist außerdem dass man die Quell-VHD herunterfährt und auf <strong>Schreibgeschützt</strong> setzt, denn wenn diese geändert wird sind alle erstellten Differenzierenden Disks ungültig.</p>  <p><strong>Update:</strong> Wenn man die VMs so dupliziert erhalten alle “Child” VMs die gleiche MAC Adresse. Die einzige Lösung die ich im Moment gefunden habe ist in der .vmc Datei die MAC Adresse zu löschen, dann wird einen neue generiert. </p>  <p><a href="/assets/image_44.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/image_thumb_44.png" width="244" height="49" /></a></p>  <p>Also kann man sagen um die Quell VM richtig vorzubereiten muss man 3 Punkte beachten:</p>  <ol>   <li>Betriebssystem vorbereiten (sysprep) </li>    <li>Quell VM herunterfahren und VHD als Read-Only markieren </li>    <li>MAC Adresse aus der Konfigurationsdatei der Quell VM löschen </li> </ol>  <p>   <br />Man erstellt also eine neue VM über den Button “Create virtual machine” und gibt ihr einen Namen. Bei Add Disk wählt man “Create a Virtual Hard Disk using advanced options” und dann “Differencing Hard Disk”. Der neuen HD kann man einen Namen geben und dann muss man die Quell-VHD (parent) angeben.</p>  <p><a href="/assets/image_43.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/image_thumb_43.png" width="244" height="189" /></a> </p>  <p>Wenige Sekunden später hat man eine neue VM bei der man nur noch die Windows Einstellungen anpassen muss. Der Vorteil ist dass nicht die ganze Quell-VM kopiert wird, sondern nur der Teil ab dem man die Differenzierende HD erstellt. So spart man neben viel Zeit auch noch einiges an Speicherplatz.</p>  <p>viele Grüße!    <br />tt</p>
