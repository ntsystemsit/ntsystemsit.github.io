---
layout: post
title: "Exchange 2010–Database Restore"
date: 2010-08-08 13:54:27 +0200
comments: true
published: true
excerpt_separator: <!-- more -->
tags: ["Exchange"]
redirect_from: ["/post/Exchange-2010e28093Database-Restore", "/post/exchange-2010e28093database-restore"]
---
<!-- more -->
{% include imported_disclaimer.html %}
<p>Nachdem die Exchange Datenbank <a href="/post/Exchange-2010-e28093-Backup.aspx" target="_blank">erfolgreich gesichert</a> wurde, sollte man sich den Recovery Vorgang mal genauer anschauen.</p>  <p>Man kann jetzt einzelne Elemente oder ganze Mailboxen löschen um diese vom Backup wieder zurück zu holen. Zwar gibt es mit Single Item Recovery eine bessere Möglichkeit für das Widerherstellen einzelner Mails, dazu aber mehr in einem anderen Beitrag.</p>  <p>Die Datenbank wird also von der Sicherung zurückgeholt, dazu starte ich Windows Backup und wähle Recovery. Ich kann nun aus den erstellten Backups wählen und entscheide mich für eines auf einem Netzlaufwerk.</p>  <p>&#160;<a href="/assets/image_203.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" class="wlDisabledImage" title="image" border="0" alt="image" src="/assets/image_thumb_201.png" width="244" height="191" /></a><a href="/assets/image_204.png"><img style="border-right-width: 0px; margin: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" class="wlDisabledImage" title="image" border="0" alt="image" src="/assets/image_thumb_202.png" width="244" height="192" /></a></p>  <p>Nun kann ich wählen was ich Widerherstellen möchte, in meinem Fall einzelne Dateien oder Ordner. Ich hole mir also die *.edb Datei der Datenbank und den kompletten Log Folder derselben zurück. Das Ganze darf natürlich nicht an der ursprünglichen Stelle widerhergestellt werden, sondern in einem neuen Ordner.</p>  <p>Wurden die Files zurückgeholt, kann man die Recovery Database erstellen. Dazu brauchen wir mal wieder die dunkle Seite der Macht, also öffne ich die Exchange Management Shell. Dort wird mit dem cmdlet new-MailboxDatabase eine Recovery Database aus der widerhergestellten *.edb Datei erstellt.</p>  <p>Dieses Beispiel erstellt die Recovery Database RDB01 auf dem Server mbx01, X:\restore ist dabei der Ort an dem die Edb Datei und der Log Ordner Widerhergestellt wurden.</p>  <ul>   <li>New-MailboxDatabase –Recovery <em>Rdb01 –</em>Server <em>mbx01 –</em>EdbFilePath <em>x:\restore\db.edb</em> –LogFolderPath <em>x:\restore</em> </li> </ul>  <p>Die Datenbank wurde erstellt, jedoch wird man darauf hingewiesen dass die Datenbank noch nicht gemounted wurde, sie muss erst in einen “Clean Shutdown State” gebracht werden.</p>  <p><a href="/assets/image_205.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" class="wlDisabledImage" title="image" border="0" alt="image" src="/assets/image_thumb_203.png" width="644" height="23" /></a></p>  <p>Um die Recovery Datenbank in einen “Clean Shutdown State” zu bringen wird das Tool eseutil.exe verwendet. Dafür öffnet man eine Eingabeaufforderung (oder EMS) und lässt eseutil –p auf die edb Datei los. Der Parameter –p steht hier für Repair. In meinem Beispiel lautet der Befehl: </p>  <ul>   <li>eseutil.exe –p x:\restore\db.edb </li> </ul>  <p><a href="/assets/image_206.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" class="wlDisabledImage" title="image" border="0" alt="image" src="/assets/image_thumb_204.png" width="244" height="167" /></a></p>  <p>Nachdem Eseutil durchgelaufen ist, die Datenbank sich also im Clean Shutdown State befindet kann sie gemounted werden, das geht in der EMC mit einem Rechtsklick oder in der Shell mit Mount-Database RDB01.</p>  <p>Die Datenbank wurde erfolgreich gemounted und ich habe jetzt Zugriff auf die Daten.</p>  <p>Mit dem cmdlet Export-Mailbox können jetzt einzelne Mails oder ganze Mailboxen widerhergestellt werden, <a href="/post/ImportExport-Mailbox.aspx" target="_blank">mehr zum cmdlet Export-Mailbox gibt es hier.</a></p>  <p>&#160;</p>  <p>tom</p>
