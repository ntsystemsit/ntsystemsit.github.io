---
layout: post
title: "Exchange 2010 Pfad einer Mailboxdatenbank ändern"
date: 2010-09-18 14:11:00 +0200
comments: true
published: true
excerpt_separator: <!-- more -->
tags: ["Exchange", "Server"]
redirect_from: ["/post/Exchange-2010-Pfad-einer-Mailboxdatenbank-andern", "/post/exchange-2010-pfad-einer-mailboxdatenbank-andern"]
---
<!-- more -->
{% include imported_disclaimer.html %}
<p>Der Pfad zu einer Exchange 2010 Mailboxdatenbank kann geändert werden, die Datenbank muss dazu allerding “dismounted” also offline sein. Das heißt die Benutzer deren Mailbox sich in der betreffenden Datenbank befinden habe für die Zeit der Änderung keinen Zugriff auf ihre Mailbox.</p>  <p>Ich werde im Beispiel zwischen einer einzelnen Datenbank und einer Datenbank in einer DAG mit mehreren Kopien unterscheiden. </p>  <h4>Einzelne Datenbank</h4>  <p>Der Datenbankpfad kann mit der EMC sowie mit der EMS verschoben werden.</p>  <p>Exchange Management Console</p>  <ul>   <li>Rechtsklick auf Datenbank, Dismount </li>    <li>Wenn die Datenbank offline ist, wieder Rechtsklick und Move Databse Path auswählen. </li> </ul>  <p><a href="/assets/image_271.png"><img style="background-image: none; border-right-width: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/image_thumb_269.png" width="244" height="215" /></a></p>  <p>   <br />Exchange Management Shell</p>  <ul>   <li>Datenbank offline nehmen mit      <br /><em>Dismount-Database DB01 </em></li>    <li>Pfad ändern      <br /><em>Move-DatabaseFilePath DB01 –EdbFilePath M:\db01\db01.edb –LogFolderPath L:\</em> </li>    <li>Datenbank wieder online nehmen      <br /><em>Mount-Database DB01</em> </li> </ul>  <h4>Datenbank in DAG</h4>  <blockquote>   <p><strong>Achtung:</strong>       <br />Wenn Circular Logging für die Datenbank aktiviert ist muss das vor der Änderung deaktiviert werden!      <br />Einstellungen wie ReplayLagTime und TruncationLagTime notieren, durch das entfernen und wieder erstellen der Datenbankkopien gehen diese Einstellungen verloren!</p> </blockquote>  <ol>   <li>Alle Datenbankkopien entfernen, d.h. Datenbank wird nur auf einem Server belassen, auf diesem wird der Pfad geändert      <br /><em>Remove-MailboxDatabaseCopy </em></li>    <li>Datenbank offline nehmen (einzige verbleibende Kopie)      <br /><em>Dismount-Database </em></li>    <li>Datenbankpfad verschieben      <br /><em>Move-DatabasePath –EdbFilePath –LogFolderPath </em></li>    <li>Auf allen Servern die eine Kopie der Datenbank enthalten sollen muss der neue Pfad existieren, durch kopieren der alten Files an den neuen Pfad kann man zeit und Replikationstraffic sparen, die Datenbank muss so nicht neu geseedet werden </li>    <li>Datenbank wieder online nehmen      <br /><em>Mount-Database </em></li>    <li>Datenbankkopien wieder erstellen      <br /><em>Add-MailboxDatabaseCopy </em></li>    <li>Index und Search Dienste neu starten      <br /><em>net stop msftesql-Exchange        <br />net start MSExchangeSearch </em></li>    <li>Replikation überprüfen      <br /><em>Test-ReplicationHealth        <br />Get-MailboxDatabaseCopyStatus </em></li> </ol>  <p>&#160;</p>  <h4>Fehler beim entfernen/hinzufügen von Kopien</h4>  <p>Beim entfernen einer Mailboxdatenbankkopie kann es zu einem Fehler mit folgender Meldung kommen: </p>  <blockquote>   <p>Error:      <br />Registry key has subkeys and recursive removes are not supported by this method.</p>    <p>Warning:      <br />An unexpected error has occurred and a Watson dump is being generated: Registry key has subkeys and recursive removes are not supported by this method.</p> </blockquote>  <p>Obwohl der Fehler auftritt wird die Datenbankkopie gelöscht. Allerdings bekommt man beim wiedererstellen der Datenbankkopie den selben Fehler und die Kopie wird nicht erstellt. Es hilft folgender Workaround.</p>  <ul>   <li>GUID der betreffenden Datenbank herausfinden     <br /><em>Get-MailboxDatabase db01 | fl name,guid </em></li>    <li>Auf dem Server, auf dem die Datenbankkopie erstellt werden soll muss folgender Registry Key gelöscht werden     <br />HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ExchangeServer\v14\Replay\State\{GUID}\DumpsterInfo </li> </ul>  <p>Jetzt wird das Add-MailboxDatabaseCopy cmdlet erneut ausgeführt und die Kopie wird erstellt.</p>  <p>&#160;</p>  <p>tom</p>
