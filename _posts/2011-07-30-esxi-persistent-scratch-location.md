---
layout: post
title: "ESXi–Persistent Scratch Location"
date: 2011-07-30 15:56:05 +0200
comments: true
published: true
excerpt_separator: <!-- more -->
tags: ["VMware", "Server"]
redirect_from: ["/post/ESXi-Persistent-Scratch-Location", "/post/esxi-persistent-scratch-location"]
---
<!-- more -->
{% include imported_disclaimer.html %}
<p>In <a href="/post/Create-VMWare-ESXi-Flash-Drive.aspx" target="_blank">diesem Artikel</a> habe ich beschrieben wie man den ESXi Hypervisor auf einem USB Stick installieren kann. Ein Nachteil dieser Installation ist das Fehlen der Scratch Partition, sie wird nicht automatisch erstellt da Flash Medien eine beschränkte Anzahl von schreib/lese Zyklen haben und sich so nicht besonders als Speicherort für Logfiles eignen.</p>  <p>&#160;</p>  <h1>ESXi Scratch Partition</h1>  <p>Die Scratch Partition ist optional und wird standardmäßig während der Installation von ESXi auf lokalem Storage angelegt. Wenn lokaler Storage verfügbar ist wird die Scratch Partition mit 4GB angelegt, sie wird verwendet um den Output von “vm-support” zu speichern, gibt es keine Scratch Partition wird dieser wird dieser Output in den RAM geschrieben.</p>  <p>Wird die Scratch Partition automatisch erstellt ist es nicht empfohlen die bestehende Konfiguration zu ändern, wird die Scratch Partition nicht automatisch angelegt (z.B. bei Installation auf USB) ist es empfohlen manuell einen Speicherort für “Scratch” zu konfigurieren.</p>  <h1>Configure Scratch Location – vSphere Client</h1>  <p>Um die Scratch Location manuell zu konfigurieren muss man zuerst einen Ordner auf einem Datastore anlegen, der ESXi Host muss natürlich Zugriff auf diesen Datastore haben. Dazu wechselt man im vSphere Client auf “Configuration” und wählt unter “Storage” einen Datastore aus, mit rechtsklick “Browse Datastore” öffnet man den Datastore Browser und legt einen Ordner an. </p>  <p>Achtung: Es muss einen eindeutigen Ordner pro ESXi Host geben, man kann nicht einen Scratch Ordner für mehrere Hosts verwenden!</p>  <p>Die Scratch Location wird in den “Advanced Settings” unter “Configuration”, “Software” konfiguriert. Dort gibt es einen Abschnitt “ScratchConfig” welcher ein Textfeld für die Einstellung “ScratchConfig.ConfiguredScratchLocation” anzeigt. In dieses Textfeld muss der vollständige Pfad zum Order eingegeben werden, also z.B: /vmfs/volumes/&lt;myDatastore&gt;/.scratch-esx1</p>  <p><a href="/assets/image_338.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/image_thumb_336.png" width="244" height="204" /></a></p>  <p>Achtung: diese Einstellung wird erst nach einem Neustart des ESXi Hosts wirksam.</p>  <h1>vSphere Client Login– A general system error occured</h1>  <p>Wird eine Active Directory Domain zur Authentifizierung angegeben und es ist keine Scratch Partition Konfiguriert kann man sich am vSphere Client nicht anmelden und bekommt eine (sehr vielsagende) Fehlermeldung, entweder: “A general system error occured” oder “gss_acquire_cred failed”</p>  <p><a href="/assets/image_339.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/image_thumb_337.png" width="244" height="218" /></a></p>  <p>Der Grund für den Fehler ist offensichtlich dass ESXi versucht Informationen über die Anmeldung in ein Logfile unter /scratch/var/tmp zu schreiben.</p>  <p>Genauere Infos zum Thema gibts hier:</p>  <p><a title="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1033696" href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1033696">http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1033696</a></p>  <p><a title="http://blogs.vmware.com/esxi/2011/04/scratch-partition-best-practices-for-usbsd-booted-esxi.html" href="http://blogs.vmware.com/esxi/2011/04/scratch-partition-best-practices-for-usbsd-booted-esxi.html">http://blogs.vmware.com/esxi/2011/04/scratch-partition-best-practices-for-usbsd-booted-esxi.html</a></p>  <p><a title="http://blogs.vmware.com/esxi/2011/03/ops-changes-part-5-scratch-partition.html" href="http://blogs.vmware.com/esxi/2011/03/ops-changes-part-5-scratch-partition.html">http://blogs.vmware.com/esxi/2011/03/ops-changes-part-5-scratch-partition.html</a></p>  <p>so long,   <br />tom</p>
