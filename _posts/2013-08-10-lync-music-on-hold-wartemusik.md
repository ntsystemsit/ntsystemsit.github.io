---
layout: post
title: "Lync: Music on Hold / Wartemusik"
date: 2013-08-10 23:01:00 +0200
comments: true
published: true
excerpt_separator: <!-- more -->
categories: Archive
tags: ["de", "Lync"]
redirect_from: ["/post/Lync-Music-on-Hold-Wartemusik", "/post/lync-music-on-hold-wartemusik"]
author: thomas torggler
---
<!-- more -->
{% include imported_disclaimer.html %}
<p>Nach einiger Zeit mal wieder ein Artikel in deutscher Sprache :)</p>  <p>Heute wollen wir uns die Music On Hold Thematik in einer Lync Enterprise Voice Umgebung anschauen. In diesem Artikel betrachten wir nur den Lync Client, MoH Konfiguration für IP Phones und Gateways werden in einem eigenen Artikel beschrieben.</p>  <h1>Was ist Music on Hold?</h1>  <p>Das kennt eigentlich jeder, trotzdem zur Erklärung: Teilnehmer A spricht mit Teilnehmer B, B möchte A weiterleiten und ruft C an. Bevor B ein neues Gespräch aufbauen kann, muss das aktuelle Gespräch gehalten werden. Damit A sich gut aufgehoben fühlt bekommt er Musik oder einen Text (“Sie werden mit dem gewünschten Teilnehmer verbunden…”) vorgespielt.</p>  <h1>Wer spielt die Musik?</h1>  <p>Jetzt wird das Thema interessant: Woher kommt die Musik? In der klassischen Telefonie wird für gewöhnlich ein “Medienserver” dafür verwendet, dieser hängt zentral an der TK Anlage und stellt Music on Hold für alle Gegenstellen zur Verfügung.</p>  <p>In einer End-to-End Infrastruktur wie Lync ist das nicht mehr so einfach, der Medien Datenstrom (Sprache) zwischen Teilnehmer A und B ist direkt, auch für die Signalisierung sind die User Agenten zuständig. Will also Teilnehmer B das aktuelle Gespräch halten, muss er dies Teilnehmer A irgendwie mitteilen und diesem dann, wenn gewünscht, Musik vorspielen.</p>  <p>In einer Lync Umgebung ist also der Lync Client von Teilnehmer B für die Musik zuständig.</p>  <h1></h1>  <h1>Welche Musik?</h1>  <p>In den Einstellungen des Lync Clients kann eine Audio Datei, die als Music on Hold gespielt wird, ausgewählt werden. </p>  <p><a href="/assets/image_564.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="/assets/image_thumb_562.png" width="244" height="172" /></a> </p>  <p>Möchte man sich für diese Aufgabe nicht auf seine Benutzer verlassen, kann man dies in einer CsClientPolicy vorgeben.</p>  <p><code>New-CsClientPolicy &quot;MusicOnHold&quot; -EnableClientMusicOnHold:$true –MusicOnHoldAudioFile:&quot;C:\Program Files (x86)\Microsoft Office\Office15\MEDIA\DefaultHold.wma&quot;</p>    <p>Grant-CsClientPolicy –Identity “Username” –PolicyName “MusicOnHold”</code></p>  <p>Diesen Pfad bekommt der Lync Client per in-band provisioning mit, das sieht im Log so aus:</p>  <p><a href="/assets/image_565.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="/assets/image_thumb_563.png" width="244" height="43" /></a> </p>  <p><strong>Achtung:</strong> Das setzen von EnableClientMusicOnHold:$true alleine ist nich ausreichend, der Benutzer muss hier nach wie vor die Datei selbst auswählen.</p>  <h1>Dateipfad</h1>  <p>Der aufmerksame Leser hat das Problem in der obigen Konfiguration sicher bereits gesehen, der Dateipfad für die Musik liegt im Installationsverzeichnis des Lync Clients. Dies unterscheidet sich allerdings von Lync 2010 zu Lync 2013 sowie bei 32 und 64 Bit Installationen.</p>  <p>Standardpfad Lync 2013: &quot;C:\Program Files (x86)\Microsoft Office\Office15\MEDIA\DefaultHold.wma&quot;   <br />Standardpfad Lync 2010: &quot;C:\Program Files (x86)\Microsoft Lync\MEDIA\DefaultHold.wma&quot;</p>  <p>Dies kann problematisch werden, wenn Benutzer sich an mehreren Geräten mit unterschiedlichen OS oder Lync Client Versionen anmelden. In diesem Fall empfiehlt es sich einen “allgemein gültigen“ Pfad in die CsClientPolicy zu schreiben. Dies kann wiederum problematisch werden wenn Benutzer sich von Unternehmensfremden Endpunkten anmelden, diese finden dann am personalisierten Pfad keine Datei, oder können nicht auf eine Freigabe zugreifen… Die aktuell Verfügbaren Konfigurationsmöglichkeiten erlauben es nicht wirklich alle Szenarien abzudecken.</p>  <h1>Ausnahme: Response Group Service</h1>  <p>Natürlich gibt es eine Ausnahme in der die Musik vom Lync Server kommt, ruft Teilnehmer A eine RGS Nummer an, kommt die Wartemusik vom Lync Server, allerdings nur bis zu dem Zeitpunkt an dem ein Agent das Gespräch entgegen nimmt. Jetzt liegt die Verantwortung beim Lync Client des Agenten, wird das Gespräch vom Agenten gehalten, kommt die Musik vom Client desselben.</p>  <p><strong>Hintergrund:</strong> Auf folgender Seite habe ich die SIP Kommunikation zwischen Teilnehmer A und B aus diesem Artikel genauer beschrieben. <a href="/page/SIP-Anruf-halten.aspx" target="_blank">SIP: Anruf halten</a></p>  <p>   <br />Schönes Wochenende!     <br />Tom</p>
