---
layout: post
title: "netsh trace and the Message Analyzer"
date: 2015-02-15 17:37:00 +0100
comments: true
published: true
excerpt_separator: <!-- more -->
categories: Archive
tags: ["Network", "en"]
redirect_from: ["/post/netsh-trace-and-the-Message-Analyzer", "/post/netsh-trace-and-the-message-analyzer"]
author: thomas torggler
---
<!-- more -->
{% include imported_disclaimer.html %}
<p>This is just a quick post about a cool feature of netsh and the successor to Microsoft’s NetMon.</p> <h1>netsh trace</h1> <p>With Windows 7 / Server 2008R2 and newer versions a cool feature has been added to netsh: the possibility to capture network traces without the need to install any third party software.</p> <p>All you need to do is to start an elevated command prompt (run as Admin) and type the following command:</p> <p><code>netsh trace start capture=yes</code></p> <p>Then do the stuff you want to capture and stop the trace by using:</p> <p><code>netsh trace stop</code></p> <p>An .etl trace will be generated and the file path is displayed.</p> <p><a href="/assets/image_672.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="/assets/image_thumb_670.png" width="244" height="85"></a> </p> <p>Note: if you use the persistent=yes parameter when starting the trace, you can even trace system reboots. </p> <h1>Microsoft Message Analyzer</h1> <p>So <a href="http://www.microsoft.com/en-us/download/details.aspx?id=4865" target="_blank">NetMon</a> has been around for a while and IT pros around the world still love it, well at least I do ;) Some time ago, Microsoft introduced its successor, a tool by the name of “Message Analyzer”. This tool can to a lot more than just network traces, find some information on the <a href="http://blogs.technet.com/b/messageanalyzer/archive/2015/01/19/announcing-message-analyzer-1-2.aspx" target="_blank">MessageAnalyzer Blog</a>.</p> <p>So I just captured a trace using netsh, copied the .etl file to my machine and then opened it in Message Analyzer. As you can see in the screenshot, the layout is quite a bit different from what we’re used from NetMon but the important things are still there.</p> <p><a href="/assets/image_673.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="/assets/image_thumb_671.png" width="244" height="153"></a> </p> <p>Filtering is quite intuitive, either write an expression into the text box at the right-hand side, or load a filter from the library. Alternatively, just right-click a property of a packet and select “Add to Filter”</p> <p><a href="/assets/image_674.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="/assets/image_thumb_672.png" width="244" height="68"></a> </p> <p>Well that’s about all I know about Message Analyzer for now. I was able to verify that packets got tagged with the DSCP values I expected and I did not have to install additional software to capture a trace.</p> <p>Happy tracing,</p> <p>Tom</p>
