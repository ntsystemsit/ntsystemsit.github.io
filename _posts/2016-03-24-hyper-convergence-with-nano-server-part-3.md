---
layout: post
title: "Hyper-Convergence with Nano Server: Part 3"
date: 2016-03-24 21:47:00 +0100
comments: true
published: true
categories: ["blog", "archives"]
excerpt_separator: <!-- more -->
tags: ["Server", "en"]
alias: ["/post/Hyper-Convergence-with-Nano-Server-Part-3.aspx", "/post/hyper-convergence-with-nano-server-part-3.aspx"]
---
<!-- more -->
{% include imported_disclaimer.html %}
<p>In this post we are going to configure the Hyper-V part of our hyper-converged Nano-Server-Cluster. We already deployed the VMs in <a href="/post/Hyper-Convergence-with-Nano-Server-Part-1.aspx" target="_blank">part 1</a> an configured Storage Spaces Direct in <a href="/post/Hyper-Convergence-with-Nano-Server-Part-2.aspx" target="_blank">part 2</a>.</p> <h1></h1> <h1>Hyper-V</h1> <p>When creating the Nano Server VHD files, I installed the Hyper-V role by selecting the –Compute parameter. As we have already created the cluster and the virtual disk, we could simply go ahead and create VMs now. </p> <p>Before doing that, I wanted to configure the Hyper-V Servers to&nbsp; store VM configurations and VHD files on the Cluster Shared Volume and I created a virtual Switch that can be used by the VMs:</p> <p><script src="https://gist.github.com/tomtorggler/51b9cf64e8509852b60b.js"></script></p> <p>As you can see, I’m using the $cimSessions variable from part 1 again. This variable contains CIM Sessions to my four Nano Servers, so that the above lines do configure all servers at once. Here’s how I’ve created those sessions: </p> <p><code>$cimSessions = New-CimSession -ComputerName n01,n02,n03,n04</code></p> <h1></h1> <h1>VMs</h1> <p>Now we are ready to create the VMs and add them to the cluster. I copied the “win2012r2.vhdx” file over to the ClusterStorage and used this as a parent disk for my VMs: </p> <p><script src="https://gist.github.com/tomtorggler/731a4ebc7233683ff894.js"></script></p> <p>That was pretty easy, so lets have a look at what our current environment looks like in the Failover Cluster Manager.</p> <p><a href="/assets/image_697.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/assets/image_thumb_695.png" width="644" height="168"></a></p> <p>We see all the VMs that were added to the cluster and we can go ahead and move them around between nodes using the Failover Cluster Manager. The same goes for the “nodes”, we see all four Nano Servers participating in the cluster and we can control the nodes status:</p> <p><a href="/assets/image_699.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/assets/image_thumb_697.png" width="644" height="197"></a></p> <p>In the storage folder of the FCM we see the virtual disk and some information about health status and capacity:</p> <p><a href="/assets/image_700.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="/assets/image_thumb_698.png" width="644" height="267"></a></p>   <p>&nbsp;</p> <p>Ok, that is pretty basic stuff if you just look at the Hyper-V part. The interesting point however, is that those same servers do also provide the shared storage that the hypervisors use.</p> <p>Stay tuned for more </p> <p>Tom</p>
