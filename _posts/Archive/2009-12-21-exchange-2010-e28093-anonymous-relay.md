---
layout: post
title: "Exchange 2010 – Anonymous Relay"
date: 2009-12-21 23:07:00 +0100
comments: true
category: Archive
tags: ["Exchange", "Server"]
redirect_from: ["/post/Exchange-2010-e28093-Anonymous-Relay", "/post/exchange-2010-e28093-anonymous-relay"]
author: thomas torggler
language: de
---
<!-- more -->
<p>Immer wieder gibt es Gründe (z.B. SharePoint) um bestimmten Hosts anonymes Relaying über Exchange zu erlauben. Man muss sich so eine Konfiguration natürlich gut überlegen und die entsprechenden Hosts müssen vertrauenswürdig bzw. sicher sein.</p>  <p>Man erstellt also einen neuen “Custom” Receive Conenctor, dem man erst mal einen Namen geben muss (Server Configuration, Hub Transport).</p>  <p><a href="/assets/archive/image_82.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_82.png" width="244" height="213" /></a> </p>  <p>Unter “Local Network Settings” kann man die IP Adresse angeben über welche der Exchange Server am besten mit dem Host reden kann. Wenn man nur eine Netzwerkkarte im Hub Transport Server hat kann man sich diese Einstellung schenken und einfach alle verfügbaren IPv4 Adressen verwenden. Außerdem kann man noch den FQDN eingeben mit dem sich der Exchange Server melden soll.</p>  <p><a href="/assets/archive/image_83.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_83.png" width="244" height="213" /></a> </p>  <p>Unter “Remote Network Settings” wird jetzt der Host (bzw. die Hosts) hinzugefügt der anonym über den Exchange Relayen darf. <strong>Wichtig:</strong> der Host muss wirklich vertrauenswürdig sein und AntiVirus bzw. Firewall sollen laufen, damit man nicht selbst zur Spamschleuder wird. Man kann einzelne Hosts, IP Bereiche oder ganze Subnets angeben.</p>  <p><a href="/assets/archive/image_84.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_84.png" width="244" height="213" /></a> </p>  <p>Durch klicken auf weiter und wird der Connector erstellt. Jetzt muss man noch die benötigten Berechtigungen setzen. Dazu Rechtsklick auf den Connector und die Eigenschaften öffnen. Unter “Authentication” werden alle Felder deaktiviert, unter “Permission Groups” wird die Gruppe Anonymous Users hinzugefügt. </p>  <p><a href="/assets/archive/image_85.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_85.png" width="218" height="244" /></a> </p>  <p><a href="/assets/archive/image_86.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_86.png" width="218" height="244" /></a> </p>  <p>Das Ganze kann man natürlich auch wieder mit der PowerShell machen, dazu einfach das New-ReceiveConnector cmdlet verwenden. Hier ein Beispiel:</p>  <p><code>New-ReceiveConnector -Name &quot;SharePoint Relay&quot; -Usage Custom -PermissionGroups AnonymousUsers -Bindings 0.0.0.0:25 -RemoteIpRanges 192.168.1.10,192.168.1.15-192.168.1.18</code></p>  <p>Jetzt gibt es also den Connector und die angegeben Hosts verwenden diesen, das Relaying funktioniert allerdings noch nicht.    <br />Dazu muss man dem User “NT AUTHORITY\ANONYMOUS LOGON” die Berechtigung “Ms-Exch-SMTP-Accept-Any-Recipient” geben. Diese Aktion kann man nur in der EMS (Exchange Management Shell) durchführen.</p>  <p><code>Get-ReceiveConnector &quot;SharePoint Relay&quot; | Add-ADPermission -User &quot;NT AUTHORITY\ANONYMOUS LOGON&quot; -ExtendedRights &quot;Ms-Exch-SMTP-Accept-Any-Recipient&quot;</code></p>  <p>Hat man auch das gemacht funktioniert das Realying.</p>  <p>tt</p>
{% include imported_disclaimer.html %}
