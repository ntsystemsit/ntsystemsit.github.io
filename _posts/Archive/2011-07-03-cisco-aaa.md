---
layout: post
title: "Cisco AAA"
date: 2011-07-03 11:18:31 +0200
comments: true
category: Archive
tags: ["Network", "Server"]
redirect_from: ["/post/Cisco-AAA", "/post/cisco-aaa"]
author: thomas torggler
language: de
---
<!-- more -->
<p>Nachdem der RADIUS Server konfiguriert ist geht es an die Konfiguration des Clients.</p>  <p>Bei Cisco muss dazu das “neue” AAA Model aktiviert werden. Das geht einfach mit folgendem Befehl:</p>  <p><code>aaa new-model      <br /></code></p>  <h1></h1>  <h1>Lokale Authentifizierung</h1>  <p>Achtung: nach absetzen dieses Befehls ist das neue Model aktiv, d.h. man kann sich nur mehr mit Benutzername und Passwort anmelden. Man sollte jetzt einen lokalen Benutzer angelegen, dieser kann auch im Fallback Fall, also wenn der RADIUS Server nicht erreichbar ist, verwendet werden. Mit folgendem Befehl legt man einen lokalen User cisco mit Passwort cisco an:</p>  <p><code>username cisco secret cisco </code></p>  <h1>Radius Server</h1>  <p>Bevor man RADIUS als Authentifizierung verwenden kann muss ein RADIUS Server konfiguriert werden. Mit folgenden Befehlen konfiguriert man den RADIUS Server 10.1.1.100 und den entsprechendem Pre-Shared Key. RADIUS verwendet standardmäßig die UDP Ports 1812 und 1813 für Authentifizierung und Accounting, Cisco Geräte verwenden die Ports 1645 und 1646, das kann man evtl. mit “auth-port 1812 acct-port 1813” ändern. Der NPS RADIUS Server antwortet auf beide Varianten, man muss das also nicht definieren.</p>  <p><code>radius-server host 10.1.1.100 key PRE_SHARED_KEY</code></p>  <p>Mit “radius-server retransmit x” kann man angeben wie oft eine Anfrage gesendet wird wenn innerhalb des Timeouts keine Antwort kommt. Das Zeitfenster für das Timeout kann mit “radius-server timeout x” auf x Sekunden erhöht werden. Das Interface über welches der Cisco Switch die RADIUS Anfrage schickt kann mit “ip radius source-interface x” angegeben werden.</p>  <h1>AAA Listen</h1>  <p>Das AAA Authentication Model arbeitet mit Listen, man definiert eine Liste und weißt diese Liste einem Interface zu. Die Liste “default” gilt für alle Interfaces auf denen keine andere Liste gebunden ist. Folgender Befehl setzt die Standardauthentifizierung auf RADIUS, Fallback (RADIUS nicht erreichbar) ist local:</p>  <p><code>aaa authentication login default group radius local      <br /></code></p>  <p>Ab diesem Zeitpunkt muss man sich an allen Interfaces mit Benutzername und Passwort vom RADIUS Server anmelden.</p>  <p>Wenn die Netzwerkgeräte in sicheren Serverräumen untergebracht sind kann man sich überlegen die Authentifizierung für den Console Port zu deaktivieren, damit man im Desaster Fall noch eine letzte Hoffnung auf Zugriff hat. Dazu legt man eine Liste an und setzt die Authentifizierung auf “none”, danach bindet man die Liste auf “line con 0”:</p>  <p><code>aaa authentication login liste1 none</p>    <p>line con 0      <br />&#160; login authentication liste1</code></p>  <h1>Authorization</h1>  <p>Am RADIUS Server habe ich in den Settings das Attribut Service-Type auf “Administrative” gesetzt. Dadurch müsste ich eigentlich im “enable” Mode landen. Das funktionier jedoch erst nachdem auch die Authorization auf RADIUS gesetzt wurde. Folder Befehl legt fest dass RADIUS für alle Interfaces verwendet wird, die Console ist dabei ausgeschlossen:</p>  <p><code>aaa authorization exec default group radius local</code></p>  <p>Um Authorization auf der Console über RADIUS zu aktivieren wird folgender Befehl verwendet:</p>  <p><code>aaa authorization console</code></p>  <p>Wenn ich mich erneut anmelden lande ich direkt im “Enable” Mode des Switches.</p>  <h1>Logging</h1>  <p>Am NPS wird im Event Log Security ein Event 6272 aufgezeichnet, außerdem wird im Logfile (D:\NPS\LogFiles) ein Eintrag hinzugefügt.</p>  <h1>Sniffing</h1>  <p>Mit Wireshark o.ä. sieht man ein RADIUS Access-Request Paket vom Switch zum NPS Server und ein RADIUS Access-Accept Paket vom NPS Server zum Switch.</p>  <p>Das Access-Request Paket enthält unter anderem folgende Informationen:</p>  <p>User-Name: Der Benutzer der sich am RADIUS Client anmeldet</p>  <p>Calling-Station-Id: IP Adresse des Clients (der z.B. die Telnet Session öffnet)</p>  <p>NAS-IP-Address: IP Adresse des RADIUS Clients</p>  <p>Das Access-Accept Paket enthält die AV-Pair Informationen:</p>  <p>AVP: Attribute Value Pair das am NPS konfiguriert wurde (Service-Type: Administrative)</p>    <p>&#160;</p>  <p>tom</p>
{% include imported_disclaimer.html %}
