---
layout: post
title: "Exchange 2010 Unified Messaging–Cisco Call Manager 8.6"
date: 2011-11-20 18:50:00 +0100
comments: true
category: Archive
tags: ["Exchange", "Server"]
redirect_from: ["/post/Exchange-2010-Unified-Messaging-Cisco-Call-Manager-86", "/post/exchange-2010-unified-messaging-cisco-call-manager-86"]
author: thomas torggler
language: de
---
<!-- more -->
<p>Unified Messaging in Exchange 2010 verbindet E-Mail mit Voice Messaging in einer Messaging Infrastruktur. E-Mail und Voice Mail Nachrichten werden in einer “unified” Mailbox verwaltet und der Benutzer erhält neben Outlook und OWA auch über das Telefon (OVA – Outlook Voice Access) Zugriff auf seine Mailbox.</p>  <p>Um die Unified Messaging Rolle mit der “traditionellen” Telefonwelt zu verbinden braucht man ein IP Gateway oder eine IP Telefonzentrale wie den Cisco Call Manager.</p>  <h1><span style="font-size: large">Exchange Unified Messaging</span></h1>  <p>Die Unified Messaging Server Rolle kann auf einem bestehenden Exchange Server hinzugefügt werden, alternativ kann man einen separaten UM Server installieren.</p>  <h4><span style="font-size: medium">Prerequisites</span></h4>  <p>Die notwendigen Voraussetzungen müssen auf einem Windows Server installiert werden, dazu verwendet man am besten die Powershell. Folgendes Beispiel installiert die Voraussetzungen für einen Server der nur die UM Rolle betreibt.</p>  <p><code>Add-WindowsFeature NET-Framework,RSAT-ADDS,Web-Server,Web-Basic-Auth,Web-Windows-Auth,Web-Metabase,Web-Net-Ext,Web-Lgcy-Mgmt-Console,WAS-Process-Model,RSAT-Web-Server,Desktop-Experience –Restart</code></p>  <p><strong>Achtung:</strong> Neustart erfolgt automatisch, sollte das nicht gewünscht sein den Parameter –Restart entfernen.</p>  <h4><span style="font-size: medium">UM Rolle Installieren</span></h4>  <p>Um die Exchange UM Rolle zu installieren wird Setup.exe von einer aktuellen Version der Installationsmedien ausgeführt. Auf einem neuen Server wird dann nur die Unified Messaging Rolle installiert, ein bestehender Server wird über den “Maintenance Mode” um diese Rolle erweitert.</p>  <p>Wie nach jeder Installation sollte man auch hier Windows Update ausführen und evtl. Updates installieren.</p>  <h4><span style="font-size: medium">UM Konfiguration</span></h4>  <p>Nach der Installation der Rolle muss diese konfiguriert werden.</p>  <h5><span style="font-size: small">Organization Configuration</span></h5>  <p>Ein <strong>UM Dial Plan</strong> muss erstellt werden, dazu unter Organization Configuration auf Unified Messaging klicken und “New UM Dial Plan” wählen, hier wird der URI Type “Telephone Extension” ausgewählt sowie die länge der internen Telefonnummern (Extension) angegeben.</p>  <p>Der UM Dial Plan ist die zentrale Komponente der UM Konfiguration und entspricht der Telefonzentrale bzw. Gruppen von Benutzern mit gleichen Telefonnummern (4 stellig) und dem selben URI Type (Telephone Extension).</p>  <p>Der Dial Plan wird im Active Directory unter “CN=My 4 Digit DP, CN=UM DialPlan Container, CN=Organization, CN=Microsoft Exchange, CN=Services, CN=Configuration, DC=Domain, DC=Local” gespeichert.</p>  <p><a href="/assets/archive/image_353.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_351.png" width="244" height="213" /></a></p>  <p>Gleichzeitig mit dem Dial Plan wird eine UM Mailbox Policy erstellt, auch diese wird im AD unter “CN=My 4 Digit DP Default Policy, CN=UM Mailbox Policies, CN=Organization, CN=Microsoft Exchange, CN=Services, CN=Configuration, DC=Domain,DC=Local” gespeichert.</p>  <p>Über die UM Mailbox Policy werden Einstellungen für UM aktivierte Postfächer konfiguriert.</p>  <p><a href="/assets/archive/image_354.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_352.png" width="218" height="244" /></a>&#160;</p>  <p>Als nächstes wird ein <strong>UM IP Gateway</strong> angelegt, das Gateway ist die SIP Gegenstelle. In diesem Fall gebe ich den Cisco Call Manager an. Um ein UM IP Gateway anzulegen klickt man unter Organization Configuration, Unified Messaging auf “New UM IP Gateway”.</p>  <p>Für jedes IP Gateway wird im AD unter “CN=UM IPGateway Container, CN=Organization, CN=Microsoft Exchange, CN=Services, CN=Configuration, DC=Domain, DC=Local” ein neuer Container angelegt.</p>  <p><a href="/assets/archive/image_355.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_353.png" width="244" height="213" /></a></p>  <p>Eine <strong>Hunt Group </strong>verbindet das IP Gateway mit dem Dial Plan, wird beim erstellen des UM IP Gateways ein Dial Plan angegeben wird automatisch die “Default Hunt Group” erstellt. Dieser Default Hunt Group wird kein Pilot Identifier zugewiesen, d.h. alle eingehenden Calls (SIP Invites) werden angenommen.</p>  <p>Wird die Hunt Group manuell erstellt kann ein Pilot Identifier angegeben werden, dadurch antwortet Exchange UM nur mehr auf Calls die eine konfigurierte Nummer anrufen. Ich verwende hier 9999 als Pilot Identifier, d.h. der Call Manager muss Anrufe an 9999 über den SIP Trunk routen.</p>  <p>Um eine neue Hunt Group zu erstellen wählt man unter Organization Configuration, Unified Messaging das IP Gateway aus und klickt dann auf “New UM Hunt Group”.</p>  <p><a href="/assets/archive/image_356.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_354.png" width="244" height="213" /></a></p>  <p>Die Hunt Group wird im Container des entsprechenden IP Gateways gespeichert, in diesem Fall unter: “CN=MY_CUCM_HuntGroup, CN=CUCM1, CN=UM IPGateway Container, CN=Organization, CN=Microsoft Exchange, CN=Services, CN=Configuration, DC=Domain, DC=Local”</p>  <p>Die Verbindung zum Dial Plan wird im Attribut msExchUMHuntGroupDialPlanLink gespeichert.</p>  <p>Die Exchange Unified Messaging Organisationskonfiguration ist somit abgeschlossen.</p>  <h5><span style="font-size: small">Server Configuration</span></h5>  <p>In der Server Configuration wird der Dial Plan mit einem oder mehreren Exchange UM Servern verbunden. Dazu unter Server Configuration auf Unified Messaging klicken und den entsprechenden Server auswählen. In den Eigenschaften “UM Settings” wählen und den Dial Plan hinzufügen.</p>  <p><a href="/assets/archive/image_357.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_355.png" width="218" height="244" /></a></p>  <p>Die Exchange Unified Messaging Serverkonfiguration ist damit abgeschlossen und die Exchange Umgebung ist bereit für die erste “unified” Mailbox.</p>  <h5><span style="font-size: small">Recipient Configuration</span></h5>  <p>Um eine Mailbox für UM zu aktivieren wählt man die Mailbox unter Recipient Configuration, Mailboxes aus und klickt auf Enable Unified Messaging.</p>  <p><a href="/assets/archive/image_358.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_356.png" width="244" height="213" /></a></p>  <p>Jedem Benutzer muss eine UM Mailbox Policy zugewiesen werden, außerdem muss er eine eindeutige “Extension” erhalten. Die Extension ist die Telefonnummer unter der die Voice Mailbox antwortet, also die Interne Telefonnummer des Benutzers.</p>  <p><a href="/assets/archive/image_359.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_357.png" width="244" height="213" /></a></p>  <p>Der Benutzer erhält ein Willkommens-E-mail von Unified Messaging in dem sein PIN und seine Extension mitgeteilt werden.</p>  <p>Die Extension wird dem Benutzer als “E-Mail Adresse” vom Typ EUM zugewiesen:</p>  <p><code>ProxyAddressString: EUM:1000;phone-context=CUCM1.domain.local</code></p>  <p>Soll ein Benutzer mehrere Extension erhalten kann man diese einfach als zusätzliche “E-Mail Adressen” hinzufügen.</p>  <p>&#160;</p>  <h1><span style="font-size: large">Cisco Call Manager</span></h1>  <p>Damit der Call Manager mit dem Exchange Server verbunden werden kann wird ein SIP Trunk benötigt. Außerdem muss eine Route erstellt werden über die der Call Manager weiß welche Nummern hinter dem SIP Trunk zu finden sind.</p>  <h4><span style="font-size: medium">SIP Trunk</span></h4>  <p>Der SIP Trunk wird unter Device, Trunk “Add New” erstellt.</p>  <p><a href="/assets/archive/image_360.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_358.png" width="244" height="125" /></a></p>  <p>Man muss dem Trunk einen Namen geben, den Device Pool auswählen, die IP Adresse des Exchange UM Servers als Destination angeben und ein SIP Profile sowie das SIP Trunk Security Profile auswählen. Sind mehrere Exchange UM Server vorhanden muss ein Trunk pro Server angelegt werden.</p>  <p><a href="/assets/archive/image_361.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_359.png" width="244" height="93" /></a></p>  <p>Wichtig: Für Outbound Calls muss “Redirecting Diversion Header Delivery – Outbound” aktiviert werden, durch die Informationen im Diversion Header kann der Exchange Server das Postfach aufgrund der Extension zuweisen.</p>  <p><a href="/assets/archive/image_362.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_360.png" width="244" height="120" /></a></p>  <p>Für alle anderen Einstellungen sind die Defaults des Call Managers ok. Je nach Umgebung kann es sein dass man “Media Termination Point Required” aktivieren muss.</p>  <h4><span style="font-size: medium">Route Pattern</span></h4>  <p>Damit der Call Manager Anrufe an 9999 routen kann muss man eine Route Pattern erstellen, dazu unter Call Routing, Route/Hunt auf Route Pattern klicken. Mit Add New kann eine neue Pattern hinzugefügt werden. Auch hier muss ein Device Pool sowie der SIP Trunk als Gateway angegeben werden. In Umgebungen mit mehrere Exchange UM Servern empfiehlt es sich eine Route List für die SIP Trunks anzulegen und die Pattern auf die Route List zu binden.</p>  <p><a href="/assets/archive/image_363.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_361.png" width="244" height="197" /></a></p>  <p>Die minimale Konfiguration ist dadurch abgeschlossen, wenn der UM aktivierte Benutzer mit der Nummer 1000 jetzt die Nummer 9999 anruft erhält er Zugriff auf sein Postfach über OVA. Wenn derselbe Benutzer eine Umleitung auf 9999 einrichtet werden alle eingehenden Calls auf sein Voicemail Postfach umgeleitet.</p>  <h4><span style="font-size: medium">MWI - Message Waiting Indicator</span></h4>  <p>Wenn jemand eine Nachricht hinterlässt wird diese in der Inbox angezeigt, zusätzlich kann am Phone ein MWI Status angezeigt werden (rotes LED). Der Benutzer sieht so sofort dass er eine neue Voicemail hat. Um dieses Feature zu aktivieren muss das “SIP Trunk Security Profile” geändert werden. Dazu unter System, Security auf SIP Trunk Security Profile klicken und das Profil auswählen das dem Trunk zugewiesen wurde. Bei diesem Profil muss die Option “Accept Unsolicited Notification” aktiviert werden.</p>  <p><a href="/assets/archive/image_364.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_362.png" width="244" height="189" /></a></p>  <h4><span style="font-size: medium">Voice Mail Profile</span></h4>  <p>Um den Voice Mail Button am Phone zu konfigurieren muss ein Voice Mail Pilot sowie ein Voice Mail Profile konfiguriert werden.</p>  <p>Dazu unter Advanced Features, Voice Mail auf Voice Mail Pilot klicken und mit Add New einen neuen Voice Mail Pilot erstellen.</p>  <p><a href="/assets/archive/image_365.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_363.png" width="244" height="68" /></a></p>  <p>Unter Advanced Features, Voice Mail, Voice Mail Profile kann ein neues Profil angelegt werden.</p>  <p><a href="/assets/archive/image_366.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/assets/archive/image_thumb_364.png" width="244" height="79" /></a></p>  <p>Achtung: Wird “Make this the default…” ausgewählt wird das Profil automatisch auf allen Phones konfiguriert die keine diesbezügliche Konfiguration haben.</p>  <p>Nun kann man unter Device, Phone in der entsprechenden Direct Number Configuration ein Voice Mail Profile konfigurieren.</p>  <p>&#160;</p>  <p>special thanks to pk :)</p>  <p>&#160;</p>  <p>tom</p>
{% include imported_disclaimer.html %}
