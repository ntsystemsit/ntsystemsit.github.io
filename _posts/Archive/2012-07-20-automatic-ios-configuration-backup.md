---
layout: post
title: "Automatic IOS configuration backup"
date: 2012-07-20 19:58:34 +0200
comments: true
category: Archive
tags: ["Network"]
redirect_from: ["/post/Automatic-IOS-configuration-backup", "/post/automatic-ios-configuration-backup"]
author: thomas torggler
---
<!-- more -->
<p>If you are like me you frequently forget to backup router and switch configurations before making changes. Ok, maybe not so frequently but it happens… There are some ways to prevent this from happening, we can make manual backups or use the automatic archiving feature which is built into IOS.</p>  <h1>Manual backup</h1>  <p>A manual backup can always be taken using the ‘copy startup-config' command, typing a question mark ‘?’ after that command lists possible backup destinations:</p>  <p><code>RT#copy startup-config ?      <br />&#160; archive:&#160;&#160;&#160;&#160;&#160;&#160;&#160; Copy to archive: file system       <br />&#160; flash:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Copy to flash: file system       <br />&#160; ftp:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Copy to ftp: file system       <br />&#160; http:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Copy to http: file system</code></p>  <p>So to backup a routers current startup-config to a FTP server you would simply type something like this:</p>  <p><code>RT#copy startup-config ftp://user:pass@10.10.10.1</code></p>  <p>The username and password can also be configured so that you don’t need to type them in every time you are performing a backup.</p>  <p><code>RT(config)#ip ftp username tom      <br />RT(config)#ip ftp password secret</code></p>  <p>Ok, that’s better but since the backup still has to be started manually chances are that one could forget it…</p>  <h1>Automatic archive</h1>  <p>The archive feature allows for automatic configuration backup that is triggered by a timer and the ‘write memory’ command. The following example configures the archive feature on router RT to create a backup once every 24 hours and additionally every time someone enters the ‘write-memory’ command, that is, every time someone makes a configuration change and decides to save that change:</p>  <p><code>RT(config)#archive      <br />path ftp://10.10.10.1/History/rt-config-       <br />write-memory       <br />time-period 1440</code></p>  <p>The time-period keyword simply configures how often a scheduled backup runs, if the write-memory command is configured a configuration backup is performed every time someone saves the config. The ‘show archive’ command displays the 10 latest configuration files:</p>  <p><code>RT#show archive      <br />The maximum archive configurations allowed is 10.       <br />The next archive file will be named ftp://10.10.10.1/History/rt-config--&lt;timestamp&gt;-50       <br />Archive #&#160; Name       <br />&#160;&#160; 1&#160;&#160;&#160;&#160;&#160;&#160;&#160; ftp://10.10.10.1/History/rt-config-Jul-10-13-51-57.153-47       <br />&#160;&#160; 2&#160;&#160;&#160;&#160;&#160;&#160;&#160; ftp://10.10.10.1/History/rt-config-Jul-10-13-52-57.245-48       <br />&#160;&#160; 3&#160;&#160;&#160;&#160;&#160;&#160;&#160; ftp://10.10.10.1/History/rt-config-Jul-10-13-53-57.337-49</code></p>  <p>Obviously other backup destinations such as tftp or flash can be configured. IOS does not take care of the removal of old files, so even though only the 10 latest configuration versions are shown in the ‘show archive’ output, there might be more on the server.</p>  <h1>Restoring configuration</h1>  <p>If a configuration change needs to be rolled back the ‘configure replace’ command can be used. So if a configuration change had unintended consequences the ‘configure replace ftp://10.10.10.1/History/rt-config-Jul-10-13-52-57.245-48’ command could be used to restore the current running-config from a backup.</p>  <p>&#160;</p>  <p>tom</p>
{% include imported_disclaimer.html %}
