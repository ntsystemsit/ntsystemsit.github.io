---
layout: post
title: "Lync Client certificate warning Exchange Autodiscover"
date: 2014-02-08 08:40:00 +0100
comments: true
category: Archive
tags: ["en", "Lync", "Skype4B"]
redirect_from: ["/post/Lync-Client-certificate-warning-Exchange-Autodiscover", "/post/lync-client-certificate-warning-exchange-autodiscover"]
author: thomas torggler
---
<!-- more -->
<p>I’ve seen this problem at a customer the other day, even though I had a solution to fix it, I do still not fully understand why it happens. So I’m going to document it here, we’ll see if that sheds more light… :)</p>  <h1>The Problem </h1>  <p>As the title implies, the problem is similar to this one I <a href="/post/Lync-2013-(Client)-and-LyncDiscoverInternal.aspx">described earlier</a>, it does however also affect Lync 2010 clients. Once signed-in, the Lync Client will show a certificate warning, indicating that it wants to connect to some Exchange Server but the certificate was not ok, only after double (triple) checking, the certificate really was ok.</p>  <h1></h1>  <h1>Background</h1>  <p>Sure enough, the problem only appears in certain environments, the one I was in used different domains for the SIP address and the users primary SMTP address. So, here goes an example:</p>  <p>UserPrincipalName: <a href="mailto:user@contoso.com">user@contoso.com</a>     <br />PrimarySMTPAddress: <a href="mailto:user@contoso.com">user@contoso.com</a>     <br />msRTCSIP-PrimaryUserAddress: <a href="mailto:user@fabrikam.com">user@fabrikam.com</a></p>  <p>When this users signs into Lync, the client will perform an Exchange Autodiscover request, in order to retrieve the Exchange Web Services Endpoint. The certificate used on the Exchange Server had the following attributes:</p>  <p>CN=exchange.contoso.com    <br />DNS=exchange.contoso.com     <br />DNS=exchange.fabrikam.com     <br />DNS=….</p>  <p>Now the warning in the Lync Client says there was a problem connecting to exchange.contoso.com, even though the certificates CN was exactly the same name, that the client tired to reach. Makes sense? Not to me…</p>  <h1>Workaround</h1>  <p>The workaround I described in the earlier article still applies, just add the Exchange Servers domain to the clients TrustModelData registry entry. </p>  <p>The registry key locations change depending on the client version:</p>  <table cellspacing="0" cellpadding="2" width="629" border="0"><tbody>     <tr>       <td valign="top" width="109">Lync 2010</td>        <td valign="top" width="518">         <p>HKEY_CURRENT_USER\Software\Microsoft\Communicator\TrustModelData</p>       </td>     </tr>      <tr>       <td valign="top" width="109">Lync 2013</td>        <td valign="top" width="518">         <p>HKEY_CURRENT_USER\Software\Policies\Microsoft\Office\15.0\Lync</p>       </td>     </tr>      <tr>       <td valign="top" width="109">Type</td>        <td valign="top" width="518">Reg_SZ</td>     </tr>      <tr>       <td valign="top" width="109">Value</td>        <td valign="top" width="518">contoso.com contoso.eu</td>     </tr>   </tbody></table>  <p>So if anyone has more information on this one, please do get in touch.</p>  <p>Cheers,    <br />tom</p>
{% include imported_disclaimer.html %}
