---
layout: post
title: "NoOp and NAT Traversal"
date: 2014-07-29 20:03:00 +0200
comments: true
category: Archive
tags: ["en", "Lync", "Skype4B"]
redirect_from: ["/post/NoOp-and-NAT-Traversal", "/post/noop-and-nat-traversal"]
author: thomas torggler
---
<!-- more -->
<p>In a recent Lync project I came across an interesting issue with SIP Trunks, fortunately we had an AudioCodes SBC so there was a simple solution to the problem. </p>  <h1>Problem </h1>  <p>In some call-forwarding scenarios no audio connection could be established, a debug trace on the gateway would show no RTP packets at all.</p>  <p><a href="/assets/archive/image6_1.png"><img width="244" height="85" title="image" style="border-width: 0px; display: inline;" alt="image" src="/assets/archive/image6_thumb_1.png" border="0"></a>&nbsp;</p>  <p>Signaling was working just fine, all the right IPs and Ports were listed within the SDP messages, as you see in the screenshot, though, no RTP packets can be seen.</p>  <h1>Solution</h1>  <p>Apparently the SIP provider used some kind of NAT or security device in front of their SIP equipment, and pinholes were only opened when this device received any incoming packets from our side of the communication.</p>  <p>That’s when I learned about the “NoOpEnable” parameter which is designed for problems, just like this one. Once the “NoOpEnable” parameter is set to “True”, the SBC will send one RTP packet (with payload No-Op) to each IP involved in the session (retrieved from SDP). The following Screenshot shows another debug trace, please note the first to RTP packets:</p>  <p><a href="/assets/archive/image_668.png"><img width="244" height="116" title="image" style="border-width: 0px; display: inline;" alt="image" src="/assets/archive/image_thumb_666.png" border="0"></a></p>  <p>This did the trick, whatever device the remote side was using, it let RTP packets through once it received an incoming packet.</p>  <p>For more Information on the No-Op Payload Type, check out the following IETF Draft: <a href="https://tools.ietf.org/html/draft-wing-avt-rtp-noop-03" target="_blank">A No-Op Payload Format for RTP</a></p>  <p></p>  <p></p>  <h1>Enable NoOp</h1>  <p>The NoOpEnable parameter can be configured using the devices AdminPage, which can be found at: https://&lt;IPAddress&gt;/AdminPage</p>  <p><a href="/assets/archive/image_669.png"><img width="244" height="63" title="image" style="border: 0px currentColor; display: inline;" alt="image" src="/assets/archive/image_thumb_667.png" border="0"></a> </p>  <p>Another way, the one I prefer nowadays, is to use the SSH command-line interface, simply connect to the device using PuTTY or TeraTerm and use the following syntax:</p>  <p>configure voip   <br> media RTP-RTCP    <br>&nbsp; no-operation-enable 1    <br>&nbsp; activate</p>  <p>&nbsp;</p>  <h1>Lessons learned</h1>  <p>Always use an SBC if dealing with SIP trunks :) </p>  <p>&nbsp;</p>  <p>Tom</p>
{% include imported_disclaimer.html %}
